#ifndef INC_USER_USART_H_
#define INC_USER_USART_H_

#include "main.h"

#define HEAD 0xAA55
#define TAIL 0x7EFE
#define cmd1 0x0001 //开始、停止采样
#define cmd3 0x0003 //设置参数
#define cmd4 0x0004 //查询参数
#define cmd5 0x0005 //对时
#define cmd_number  5 //cmd_number为命令数量

extern volatile uint32_t rxcode;
extern volatile uint16_t SUM;
extern volatile uint16_t tail;
extern volatile uint16_t heartstate;
extern volatile uint64_t high_counter;

typedef enum
{
	CMD_OK = 0,
	CMD_FORMAT_ERROR,
	CMD_NOT_SUPPORTED,
	CMD_ADDRESS_ERROR,
	CMD_INVALID_DATA,
	CMD_BUSY,
	CMD_CHECK_ERROR
}CMD_Status;

#pragma pack(push, 1)
typedef struct
{
	uint16_t head;
	uint8_t version;
	uint16_t code;
	uint16_t command;
	uint8_t datalength;
	uint8_t data[];
}PACKAGE_TypeDef;
#pragma pack(pop)

typedef struct
{
    uint16_t year;
    uint8_t month;
    uint8_t day;
    uint8_t hour;
    uint8_t minute;
    uint8_t second;
    uint16_t millis;
} SystemTime_t;

void Receive_Data(uint8_t *rxdata, uint16_t rxlen);
CMD_Status CMD_Judge(uint8_t *rxdata, uint16_t rxlen);
CMD_Status CMD_Execute(uint8_t *rxdata, uint16_t rxlen);
void HAL_UART_TxCpltCallback(UART_HandleTypeDef *huart);

#endif
